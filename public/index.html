<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>HODL Token Club | Rewards</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #05070a;
      --card-bg: rgba(13, 17, 23, 0.7);
      --accent: #00ffc3;
      --accent-glow: rgba(0, 255, 195, 0.4);
      --text-main: #e6edf3;
      --text-dim: #8b949e;
      --border: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.05);
    }

    * { box-sizing: border-box; }

    body {
      background: radial-gradient(circle at top right, #161b22, #05070a);
      color: var(--text-main);
      font-family: 'Inter', sans-serif;
      margin: 0;
      line-height: 1.6;
      min-height: 100vh;
      padding-bottom: 60px;
    }

    .header {
      backdrop-filter: blur(12px);
      background: rgba(5, 7, 10, 0.8);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .project-title { 
      font-size: 1.2rem; 
      font-weight: 800; 
      letter-spacing: -0.5px;
      background: linear-gradient(90deg, #fff, var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .logo-hodl { height: 40px; border-radius: 50%; border: 1px solid var(--accent); }
    .logo-mvx { height: 24px; }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      max-width: 1300px;
      margin: 40px auto;
      padding: 0 20px;
      grid-auto-rows: min-content;
      align-items: stretch;
    }

    .col-span-1 { grid-column: span 1; }
    .col-span-2 { grid-column: span 2; }
    .col-span-3 { grid-column: span 3; }
    .col-span-4 { grid-column: span 4; }

    .glow-card, .glow-panel {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 24px;
      transition: transform 0.3s ease, border-color 0.3s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .glow-card:hover {
      border-color: var(--accent-glow);
      transform: translateY(-5px);
    }

    .metric-card {
      justify-content: space-between;
      align-items: stretch;
      text-align: center;
      min-height: 160px; 
    }

    .metric-title { 
      font-size: 0.75rem; 
      color: var(--text-dim); 
      text-transform: uppercase; 
      letter-spacing: 1px; 
      margin-bottom: 10px; 
      font-weight: 600;
    }

    .metric-value { 
      font-size: 1.8rem; 
      font-weight: 800; 
      color: var(--accent); 
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex-grow: 1;
    }

    .btn {
      background: var(--accent);
      color: #05070a;
      border: none;
      padding: 12px 16px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      text-transform: uppercase;
      font-size: 0.85rem;
      transition: all 0.2s ease;
      text-align: center;
      text-decoration: none;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      font-family: 'Inter', sans-serif;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

    .btn:hover { filter: brightness(1.1); box-shadow: 0 0 15px var(--accent-glow); }

    .btn-static {
      background: rgba(0, 255, 195, 0.1);
      color: var(--accent);
      border: 1px solid var(--accent);
      cursor: default;
      box-shadow: none;
    }
    .btn-static:hover { filter: none; box-shadow: none; }

    .btn-outline {
      background: transparent;
      border: 1px solid #ff5555;
      color: #ff5555;
    }
    .btn-outline:hover {
      background: rgba(255, 85, 85, 0.1);
      box-shadow: 0 0 15px rgba(255, 85, 85, 0.4);
    }

    .input-row { display: flex; flex-direction: column; width: 100%; margin-bottom: 15px; }
    
    input {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--border);
      padding: 14px;
      border-radius: 12px;
      color: white;
      width: 100%;
      font-size: 1rem;
      transition: 0.2s;
      margin-top: 5px;
    }
    input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

    .scrollable-content {
        max-height: 350px;
        overflow-y: auto;
        padding-right: 5px;
        margin-top: 10px;
        flex: 1;
        scrollbar-width: thin;
        scrollbar-color: var(--accent) transparent;
    }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 3px; }

    .rank-badge {
      background: linear-gradient(135deg, var(--accent), #00b894);
      color: #000;
      padding: 6px 14px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: 800;
      text-transform: uppercase;
      margin-bottom: 5px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .category-totals, #excludedNFTsList { padding-left: 0; list-style: none; }
    .category-totals li, #excludedNFTsList li {
        padding: 8px 0;
        border-bottom: 1px solid var(--glass-border);
        color: var(--text-dim);
        font-size: 0.9rem;
    }
    .category-totals li strong { color: var(--text-main); }

    details { background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 8px; border: 1px solid var(--glass-border); }
    summary { padding: 12px; cursor: pointer; font-weight: 600; list-style: none; display: flex; justify-content: space-between; color: var(--text-main); font-size: 0.9rem; align-items: center; }
    summary::after { content: 'â†’'; transition: 0.3s; color: var(--accent); }
    details[open] summary::after { transform: rotate(90deg); }
    details ul { padding: 10px 20px; margin: 0; list-style: none; }
    details li { font-size: 0.85rem; color: var(--text-dim); padding: 4px 0; }

    #passwordSection, #rewardsManagement {
        background: var(--card-bg);
        border: 1px solid var(--accent);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(20px);
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
    }
    table { width: 100%; border-collapse: collapse; color: var(--text-dim); }
    th { text-align: left; border-bottom: 1px solid var(--accent); padding: 10px; color: var(--accent); }
    td { padding: 10px; border-bottom: 1px solid var(--glass-border); }

    @media (max-width: 1024px) {
      .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
      .col-span-1, .col-span-2, .col-span-3, .col-span-4 { grid-column: span 2; }
      #publicCalculator { grid-column: span 2; }
    }
    @media (max-width: 768px) {
      .dashboard-grid { grid-template-columns: 1fr; }
      .col-span-1, .col-span-2, .col-span-3, .col-span-4 { grid-column: span 1; }
      #publicCalculator { grid-column: span 1; }
      .header { flex-direction: column; text-align: center; gap: 15px; }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="header-left" style="display: flex; align-items: center; gap: 15px;">
    <img src="Hodl_logo.jpg" alt="Logo" class="logo-hodl" />
    <div class="project-title">HODL TOKEN CLUB</div>
  </div>
  <div class="header-right">
    <img src="mvx-ledger-icon-mint.svg" alt="MVX" class="logo-mvx" />
  </div>
</header>

<div class="dashboard-grid">
  
  <div class="glow-card metric-card col-span-1">
    <div class="metric-title">Live Supply</div>
    <div class="btn" style="cursor: default;">Sold Out</div>
  </div>

  <div class="glow-card metric-card col-span-1">
    <div class="metric-title">Analytics</div>
    <a href="http://203.161.43.175:3012/stats.html" target="_blank" rel="noopener" class="btn">View Stats</a>
  </div>

  <div class="glow-card metric-card col-span-1">
    <div class="metric-title">Actions</div>
    <button class="btn" id="showManageBtn">Admin Access</button>
  </div>

  <div class="glow-card metric-card col-span-1">
    <div class="metric-title">Marketplace</div>
    <a href="https://oox.art/marketplace/collections/EMP-897b49" target="_blank" rel="noopener" class="btn">Go to Market</a>
  </div>


  <div class="glow-card col-span-3" id="publicCalculator">
    <div class="metric-title" style="font-size: 1rem;">Reward Calculator</div>
    <p style="color:var(--text-dim); font-size: 0.9rem; margin-top: -10px; margin-bottom: 20px;">Check your weekly MultiversX rewards</p>
    
    <form class="input-row" onsubmit="return false;">
      <label for="walletInput" style="font-size: 0.85rem; color: var(--text-dim);">Wallet Address or Herotag</label>
      <div style="display:flex; gap:15px; margin-top: 5px; flex-wrap:wrap;">
          <input type="text" id="walletInput" placeholder="@herotag or erd1..." autocomplete="off" style="margin-top:0; flex:1;" />
          <button class="btn" id="calculateBtn" style="width: auto; padding: 0 40px;">Check</button>
      </div>
    </form>
  </div>

  <div class="glow-card metric-card col-span-1">
    <div class="metric-title">Rank Status</div>
    <div class="metric-value" id="walletRankDisplay">â€”</div>
  </div>


  <div class="glow-panel col-span-2" style="margin-top: 20px;">
    <div class="metric-title">Total Weekly Reward</div>
    <div id="totalReward" style="font-size: 3rem; font-weight: 900; color: var(--accent); margin-bottom: 5px; text-shadow: 0 0 20px var(--accent-glow); text-align: center;">0</div>
    <div style="color: var(--text-dim); margin-bottom: 20px; text-align: center;">$REWARD Tokens</div>
    
    <div class="metric-title" style="margin-bottom: 10px; border-top: 1px solid var(--glass-border); padding-top: 15px;">Category Breakdown</div>
    <div class="scrollable-content">
      <ul class="category-totals" id="categoryTotals"></ul>
    </div>
  </div>

  <div class="glow-panel col-span-2" style="margin-top: 20px;">
    <div class="metric-title">Detailed Assets</div>
    <div class="scrollable-content">
      <div id="categoriesContainer"></div>
      
      <div id="excludedNFTsSection" style="margin-top:20px; padding-top:10px; border-top: 1px dashed var(--glass-border);">
        <div style="font-size:0.8rem; font-weight:600; color: #ff5555; margin-bottom:5px; text-transform: uppercase;">Excluded NFTs</div>
        <ul id="excludedNFTsList"></ul>
      </div>
    </div>
  </div>

</div>

<div id="passwordSection" style="display:none; margin: 20px auto; max-width:900px;">
  <label for="passwordInput" style="display:block; margin-bottom:10px; color: var(--accent); font-weight:bold;">Enter Admin Password:</label>
  <input type="password" id="passwordInput" placeholder="Password..." />
  <div style="margin-top:15px; display:flex; gap: 10px;">
    <button class="btn" id="passwordBtn">Submit</button>
    <button class="btn btn-outline" id="cancelPasswordBtn">Cancel</button>
  </div>
  <div class="error" id="passwordError" style="margin-top: 8px; color: #ff5555;"></div>
</div>

<div id="rewardsManagement" style="display:none; max-width:900px; margin: 32px auto;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
      <h2 style="margin:0; color:var(--text-main);">Manage Rewards</h2>
      <button id="logoutBtn" class="btn btn-outline" style="width:auto;">Logout</button>
  </div>
  
  <form id="addRewardForm" style="display:flex; gap: 10px; flex-wrap: wrap; align-items:center; margin-bottom: 20px;">
    <div style="flex: 1 1 200px;">
      <input type="text" id="newCategory" required placeholder="Category Name" />
    </div>
    <div style="flex: 1 1 100px;">
      <input type="number" id="newReward" required min="0" placeholder="Reward Amount" />
    </div>
    <button type="submit" class="btn" style="flex: 0 0 auto; width: auto;">Save</button>
  </form>
  <div class="error" id="formError" style="margin-top: 6px; color:#ff5555;"></div>
  
  <div style="overflow-x:auto;">
    <table id="rewardsTable">
      <thead>
        <tr>
          <th>Category</th>
          <th style="text-align:right;">Reward</th>
          <th style="text-align:center;">Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <button id="resyncCollectionBtn" class="btn" style="margin-top: 20px; background: transparent; border: 1px solid var(--accent); color: var(--accent);">Resync Categories</button>
</div>

<script>
const empCollectionId = "EMP-897b49";
const fhodlCollectionId = "FHODL-a9ad67";
const fhodlRewardRate = 1400;

// Elements
const walletRankDisplay = document.getElementById('walletRankDisplay');
const calculateBtn = document.getElementById('calculateBtn');
const walletInput = document.getElementById('walletInput');
const showManageBtn = document.getElementById('showManageBtn');
const passwordSection = document.getElementById('passwordSection');
const passwordInput = document.getElementById('passwordInput');
const passwordBtn = document.getElementById('passwordBtn');
const cancelPasswordBtn = document.getElementById('cancelPasswordBtn');
const passwordError = document.getElementById('passwordError');
const rewardsDiv = document.getElementById('rewardsManagement');
const logoutBtn = document.getElementById('logoutBtn');
const totalRewardEl = document.getElementById('totalReward');
const categoryTotalsEl = document.getElementById('categoryTotals');
const categoriesContainer = document.getElementById('categoriesContainer');
const excludedList = document.getElementById('excludedNFTsList');
const rewardsTableBody = document.querySelector('#rewardsTable tbody');
const formError = document.getElementById('formError');
const addRewardForm = document.getElementById('addRewardForm');

// --- ADMIN UI HANDLERS ---
showManageBtn.addEventListener('click', () => {
  document.querySelector('.dashboard-grid').style.display = 'none';
  passwordSection.style.display = 'block';
  passwordInput.focus();
});

passwordBtn.addEventListener('click', () => {
  if (passwordInput.value.trim() === 'nothing') {
    passwordError.textContent = '';
    passwordSection.style.display = 'none';
    passwordInput.value = '';
    rewardsDiv.style.display = 'block';
    loadConfig();
  } else {
    passwordError.textContent = 'Incorrect password';
  }
});

cancelPasswordBtn.addEventListener('click', () => {
  passwordSection.style.display = 'none';
  passwordError.textContent = '';
  passwordInput.value = '';
  document.querySelector('.dashboard-grid').style.display = 'grid';
});

logoutBtn.addEventListener('click', () => {
  rewardsDiv.style.display = 'none';
  passwordSection.style.display = 'none';
  document.querySelector('.dashboard-grid').style.display = 'grid';
  totalRewardEl.textContent = '0';
  walletRankDisplay.innerHTML = 'â€”';
  categoryTotalsEl.innerHTML = '';
  categoriesContainer.innerHTML = '';
  excludedList.innerHTML = '';
  walletInput.value = '';
});

// --- API & DATA HANDLERS ---
async function loadConfig() {
  formError.textContent = '';
  const res = await fetch('/api/config');
  const traitRewards = await res.json();
  renderTable(traitRewards);
}

function renderTable(traitRewards) {
  rewardsTableBody.innerHTML = '';
  for (const [category, rewardVal] of Object.entries(traitRewards)) {
    const reward = Number(rewardVal);
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${category}</td>
      <td style="text-align: right;">
        <input type="number" value="${isNaN(reward) ? 0 : reward}" min="0" style="width: 80px; padding: 8px; margin:0;" onchange="updateReward('${category}', this.value)">
      </td>
      <td style="text-align: center;">
        <button onclick="deleteReward('${category}')" class="btn btn-outline" style="padding:6px 12px; width:auto; display:inline-block; border-radius: 6px; cursor:pointer;">Delete</button>
      </td>
    `;
    rewardsTableBody.appendChild(row);
  }
}

async function updateReward(category, reward) {
  await fetch('/api/config', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ category, reward: parseInt(reward) }),
  });
  await loadConfig();
}

async function deleteReward(category) {
  await fetch('/api/config', {
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ category }),
  });
  await loadConfig();
}

addRewardForm.addEventListener('submit', async e => {
  e.preventDefault();
  const category = document.getElementById('newCategory').value.trim();
  const reward = parseInt(document.getElementById('newReward').value);
  await fetch('/api/config', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ category, reward }),
  });
  e.target.reset();
  await loadConfig();
});

// --- HELPER: Resolve Herotag ---
async function resolveAddress(input) {
  let cleanInput = input.trim();
  if (cleanInput.startsWith('erd1') && cleanInput.length === 62) return cleanInput;
  if (cleanInput.startsWith('@')) cleanInput = cleanInput.substring(1);
  try {
    const res = await fetch(`https://api.multiversx.com/usernames/${cleanInput}`);
    if (!res.ok) throw new Error('Herotag not found');
    const data = await res.json();
    return data.address;
  } catch (err) {
    throw new Error(`Could not resolve Herotag: ${input}`);
  }
}

// --- MAIN CALCULATION LOGIC ---
calculateBtn.addEventListener('click', async () => {
  const rawInput = walletInput.value.trim();
  totalRewardEl.textContent = '...';
  walletRankDisplay.innerHTML = 'Loading...';
  categoryTotalsEl.innerHTML = '';
  categoriesContainer.innerHTML = '';
  excludedList.innerHTML = '';
  
  if (!rawInput) {
    alert('Please enter a wallet address or Herotag');
    walletRankDisplay.innerHTML = 'â€”';
    totalRewardEl.textContent = '0';
    return;
  }
  
  try {
    const wallet = await resolveAddress(rawInput);

    const empPromise = fetch(`/api/rewards/${wallet}/${empCollectionId}`);
    const fhodlPromise = fetch(`https://api.multiversx.com/accounts/${wallet}/nfts?collection=${fhodlCollectionId}&size=2000`);

    const [empRes, fhodlRes] = await Promise.all([empPromise, fhodlPromise]);
    
    const empData = await empRes.json();
    if (!empRes.ok) throw new Error(empData.error || "Error fetching EMP data");

    const fhodlNFTs = await fhodlRes.json();
    const fhodlCount = Array.isArray(fhodlNFTs) ? fhodlNFTs.length : 0;
    const fhodlTotalReward = fhodlCount * fhodlRewardRate;

    const empTotalReward = parseFloat(empData.totalReward) || 0;
    const grandTotalReward = empTotalReward + fhodlTotalReward;

    totalRewardEl.textContent = grandTotalReward.toLocaleString();

    // --- RANK LOGIC ---
    const includedCount = empData.includedNFTs ? empData.includedNFTs.length : 0;
    const excludedCount = empData.excludedNFTs ? empData.excludedNFTs.length : 0;
    const totalEmpNFTs = includedCount + excludedCount;
    
    let rankName = 'No Rank';
    let rankEmoji = '';

    if (totalEmpNFTs >= 500) { rankName = 'Mega Whale'; rankEmoji = 'ðŸ‹'; }
    else if (totalEmpNFTs >= 250) { rankName = 'Whale'; rankEmoji = 'ðŸ³'; }
    else if (totalEmpNFTs >= 100) { rankName = 'Shark'; rankEmoji = 'ðŸ¦ˆ'; }
    else if (totalEmpNFTs >= 50) { rankName = 'Dolphin'; rankEmoji = 'ðŸ¬'; }
    else if (totalEmpNFTs >= 25) { rankName = 'Crab'; rankEmoji = 'ðŸ¦€'; }
    else if (totalEmpNFTs >= 10) { rankName = 'Fish'; rankEmoji = 'ðŸ '; }
    else if (totalEmpNFTs >= 1) { rankName = 'Plankton'; rankEmoji = 'ðŸ¦ '; }
    
    walletRankDisplay.innerHTML = ''; 
    if (totalEmpNFTs >= 1) {
        const badge = document.createElement('span');
        badge.className = 'rank-badge';
        badge.textContent = rankName;
        
        const countLabel = document.createElement('div');
        countLabel.style.fontSize = '0.6rem';
        countLabel.style.marginTop = '10px';
        countLabel.style.color = 'var(--text-dim)';
        countLabel.textContent = `${totalEmpNFTs} EMP NFTs`;

        const emojiLabel = document.createElement('div');
        emojiLabel.style.fontSize = '2rem';
        emojiLabel.style.marginTop = '5px';
        emojiLabel.textContent = rankEmoji;

        walletRankDisplay.appendChild(badge);
        walletRankDisplay.appendChild(countLabel);
        walletRankDisplay.appendChild(emojiLabel);
    } else {
        walletRankDisplay.textContent = "No EMP NFTs";
    }

    // --- CATEGORIES ---
    categoryTotalsEl.innerHTML = '';
    
    if (fhodlCount > 0) {
        categoryTotalsEl.innerHTML += `<li><strong>FHODL:</strong> ${fhodlTotalReward} $REWARD from ${fhodlCount} NFT${fhodlCount !== 1 ? 's' : ''}</li>`;
    }

    for (const [cat, info] of Object.entries(empData.categorySums || {})) {
      categoryTotalsEl.innerHTML += `<li><strong>${cat}:</strong> ${info.reward} $REWARD from ${info.count} NFT${info.count !== 1 ? 's' : ''}</li>`;
    }

    const categoriesMap = {};
    if (fhodlCount > 0) {
        categoriesMap["FHODL"] = fhodlNFTs.map(nft => ({
            name: nft.name || nft.identifier,
            reward: fhodlRewardRate,
            attributes: []
        }));
    }

    (empData.includedNFTs || []).forEach(nft => {
      nft.categories.forEach(cat => {
        if (!categoriesMap[cat]) categoriesMap[cat] = [];
        categoriesMap[cat].push(nft);
      });
    });

    categoriesContainer.innerHTML = '';
    for (const [category, nfts] of Object.entries(categoriesMap)) {
      const count = empData.categorySums?.[category]?.count || nfts.length;
      const catDetails = document.createElement('details');
      const catSummary = document.createElement('summary');
      catSummary.innerHTML = `${category} (${count} NFT${count !== 1 ? 's' : ''})`;
      catDetails.appendChild(catSummary);

      const nftList = document.createElement('ul');
      for (const nft of nfts) {
        const nftDetails = document.createElement('details');
        const nftSummary = document.createElement('summary');
        nftSummary.innerHTML = `${nft.name} (R: ${nft.reward})`;
        nftDetails.appendChild(nftSummary);

        const attrList = document.createElement('ul');
        if (nft.attributes && nft.attributes.length > 0) {
          nft.attributes.forEach(attr => {
            const li = document.createElement('li');
            li.textContent = `${attr.trait_type}: ${attr.value}`;
            attrList.appendChild(li);
          });
        } else {
          const li = document.createElement('li');
          li.innerHTML = '<em>No attributes found</em>';
          attrList.appendChild(li);
        }
        nftDetails.appendChild(attrList);
        nftList.appendChild(nftDetails);
      }
      catDetails.appendChild(nftList);
      categoriesContainer.appendChild(catDetails);
    }

    if (empData.excludedNFTs.length === 0) {
      excludedList.innerHTML = '<li>All EMP NFTs qualified.</li>';
    } else {
      empData.excludedNFTs.forEach(nft => {
        excludedList.innerHTML += `<li><strong>${nft.name}</strong> - No qualifying traits.</li>`;
      });
    }

  } catch (e) {
    totalRewardEl.textContent = 'Error';
    walletRankDisplay.textContent = 'Error';
    alert(e.message);
    console.error(e);
  }
});

document.getElementById('resyncCollectionBtn').addEventListener('click', async () => {
  try {
    const res = await fetch(`/api/all-traits/${empCollectionId}`);
    const categories = await res.json();
    for (const category of categories) {
      if (!rewardsTableBody.querySelector(`input[value="${category}"]`)) {
        await fetch('/api/config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ category, reward: 0 }),
        });
      }
    }
    alert(`Resync complete.`);
    await loadConfig();
  } catch (e) {
    alert('Resync failed: ' + e.message);
  }
});

loadConfig();
</script>
</body>
</html>
